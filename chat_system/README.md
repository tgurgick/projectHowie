# Enhanced Fantasy Football Chat System

## üöÄ Overview

A sophisticated multi-agent chat system powered by **GPT-4o** with **Pydantic structured reasoning** that provides intelligent analysis of your comprehensive fantasy football database. The system features step-by-step reasoning, natural language understanding, and specialized agents for different types of analysis.

## ‚ú® Key Features

### ü§ñ **AI-Powered Intelligence**
- **GPT-4o Integration**: Advanced natural language processing
- **Structured Reasoning**: Pydantic models ensure consistent, validated responses
- **Step-by-Step Analysis**: Transparent reasoning process for every query
- **Multi-Agent Architecture**: Specialized agents for different analysis types

### üèà **Fantasy Football Expertise**
- **Player Analysis**: Comprehensive player statistics and insights
- **Route Running Analysis**: YPRR, route grades, participation rates
- **Scheme Analysis**: Man vs Zone coverage performance
- **Market Analysis**: ADP trends, value identification, draft strategy
- **Player Comparisons**: Head-to-head analysis with recommendations
- **Strategic Advice**: Draft, trade, and start/sit recommendations

### üíª **Powerful CLI Interface**
- **Rich Terminal UI**: Beautiful, interactive command-line interface
- **Interactive Chat**: Real-time conversation with the system
- **Single Query Mode**: Ask individual questions
- **Verbose Mode**: Show detailed reasoning and analysis steps
- **Multi-Database Support**: PPR, Half-PPR, and Standard scoring

## üõ†Ô∏è Installation

### Prerequisites
- Python 3.8+
- OpenAI API key
- Fantasy football database (generated by the main ETL system)

### Setup

1. **Install Dependencies**:
```bash
cd chat_system
pip install -r requirements.txt
```

2. **Set OpenAI API Key**:
```bash
export OPENAI_API_KEY="your-openai-api-key-here"
```

3. **Verify Database**:
Ensure your fantasy football databases exist in the `data/` directory:
- `data/fantasy_ppr.db`
- `data/fantasy_halfppr.db`
- `data/fantasy_standard.db`

## üéØ Usage

### Interactive Chat Mode

Start an interactive chat session:

```bash
# Default PPR database
python enhanced_agents.py chat

# Specific database
python enhanced_agents.py chat --db halfppr

# With verbose reasoning
python enhanced_agents.py chat --db standard --verbose
```

### Single Query Mode

Ask a single question:

```bash
# Basic query
python enhanced_agents.py ask "Tell me about Justin Jefferson"

# With verbose output
python enhanced_agents.py ask "Compare CeeDee Lamb vs Tyreek Hill" --verbose

# Different database
python enhanced_agents.py ask "Who are the best route runners?" --db halfppr
```

## ü§ñ Agent Types

### 1. **Data Agent** üìä
Handles basic player statistics and information requests.

**Example Queries**:
- "Tell me about Justin Jefferson"
- "What are CeeDee Lamb's stats?"
- "Show me Tyreek Hill's performance"

### 2. **Route Analysis Agent** üèÉ
Specialized in route running analysis and metrics.

**Example Queries**:
- "Who are the best route runners?"
- "Show me YPRR analysis"
- "Top route grades in 2024"

### 3. **Market Agent** üí∞
Analyzes ADP, ECR, and market trends.

**Example Queries**:
- "What's the ADP analysis?"
- "Show me value picks"
- "Market trends for WRs"

### 4. **Strategy Agent** üéØ
Provides strategic recommendations and advice.

**Example Queries**:
- "Give me draft strategy advice"
- "Should I trade for CeeDee Lamb?"
- "Start/sit recommendations"

### 5. **Comparison Agent** ‚öñÔ∏è
Handles head-to-head player comparisons.

**Example Queries**:
- "Compare CeeDee Lamb vs Tyreek Hill"
- "Justin Jefferson vs Davante Adams"
- "Rome Odunze vs Brian Thomas Jr"

### 6. **Analytics Agent** üìà
Advanced trend analysis and statistical insights (coming soon).

## üîç Example Interactions

### Player Analysis
```
You: Tell me about Justin Jefferson

ü§ñ Assistant:
üìä **Justin Jefferson Analysis**

**Player Info:** WR - MIN

**Performance:** Average 18.2 fantasy points

**Route Running:**
‚Ä¢ YPRR: 2.85
‚Ä¢ Route Participation: 94.2%
‚Ä¢ Route Grade: 85.3

**Scheme Analysis:**
‚Ä¢ Man Coverage YPRR: 3.19
‚Ä¢ Zone Coverage YPRR: 2.78

**Market Data:**
‚Ä¢ ADP: 3
‚Ä¢ ECR Rank: 2

**Strengths:**
‚Ä¢ Elite route running efficiency
‚Ä¢ Consistent target volume
‚Ä¢ Strong contested catch ability

**Key Insights:**
‚Ä¢ Performs better vs man coverage
‚Ä¢ High route participation indicates heavy usage
‚Ä¢ Top-tier fantasy producer with room for growth
```

### Player Comparison
```
You: Compare CeeDee Lamb vs Tyreek Hill

ü§ñ Assistant:
üìä **CeeDee Lamb vs Tyreek Hill**

**Comparison by Metric:**
‚Ä¢ YPRR: Lamb (2.30) vs Hill (3.84) - Hill wins
‚Ä¢ Route Grade: Lamb (82.1) vs Hill (88.7) - Hill wins
‚Ä¢ Route Participation: Lamb (93.8%) vs Hill (91.2%) - Lamb wins

**Winner by Category:**
‚Ä¢ Route Efficiency: Tyreek Hill
‚Ä¢ Volume: CeeDee Lamb
‚Ä¢ Overall: Tyreek Hill

**Overall Recommendation:**
Tyreek Hill is the superior route runner with better efficiency metrics, while CeeDee Lamb offers higher volume and participation.

**Reasoning:**
Hill's superior YPRR and route grade indicate better route running ability, while Lamb's higher participation suggests more consistent usage patterns.
```

### Route Analysis
```
You: Who are the best route runners?

ü§ñ Assistant:
üèÉ **Top Route Runners Analysis**

**Top Performers:**
1. **Tyreek Hill** (MIA): 3.84 YPRR, 88.7 grade
2. **Justin Jefferson** (MIN): 2.85 YPRR, 85.3 grade
3. **CeeDee Lamb** (DAL): 2.30 YPRR, 82.1 grade

**Average Metrics:**
‚Ä¢ Average YPRR: 1.87
‚Ä¢ Average Route Grade: 78.4
‚Ä¢ Average Participation: 89.2%

**Key Insights:**
‚Ä¢ Elite route runners show >2.5 YPRR consistently
‚Ä¢ Route grade correlates strongly with fantasy success
‚Ä¢ High participation rates indicate heavy usage

**Recommendations:**
‚Ä¢ Target players with >2.0 YPRR in drafts
‚Ä¢ Prioritize route grade over pure volume
‚Ä¢ Consider scheme-specific matchups
```

## üèóÔ∏è System Architecture

### **Multi-Agent Design**
```
User Query ‚Üí GPT-4o Classification ‚Üí Specialized Agent ‚Üí 
‚îú‚îÄ Data Retrieval
‚îú‚îÄ AI Analysis
‚îú‚îÄ Structured Reasoning
‚îî‚îÄ Formatted Response
```

### **Pydantic Models**
- **QueryAnalysis**: Intent classification and player extraction
- **PlayerAnalysis**: Structured player insights with reasoning
- **ComparisonAnalysis**: Head-to-head analysis with recommendations
- **RouteAnalysis**: Route running insights and trends
- **MarketAnalysis**: ADP and market trend analysis
- **StrategyRecommendation**: Strategic advice with risk assessment

### **Database Integration**
- **Async Operations**: Non-blocking database queries
- **Connection Pooling**: Efficient database connections
- **Error Handling**: Robust error management
- **Multi-Database Support**: PPR, Half-PPR, Standard scoring

## üîß Configuration

### Environment Variables
```bash
export OPENAI_API_KEY="your-openai-api-key"
export FANTASY_DB_PATH="data/"  # Optional: custom database path
```

### Database Options
- `--db ppr`: Use PPR scoring database (default)
- `--db halfppr`: Use Half-PPR scoring database
- `--db standard`: Use Standard scoring database

### Output Options
- `--verbose`: Show detailed reasoning and analysis steps
- Default: Clean, formatted responses
- Verbose: Step-by-step reasoning + analysis details

## üöÄ Advanced Features

### **Structured Reasoning**
Every response includes:
- **Query Analysis**: How the system interpreted your question
- **Data Retrieval**: What data was gathered
- **AI Analysis**: How GPT-4o analyzed the data
- **Reasoning Summary**: Step-by-step process

### **Natural Language Understanding**
- **Intent Classification**: Automatically routes to the right agent
- **Player Extraction**: Identifies players mentioned in queries
- **Context Awareness**: Understands complex, multi-part questions
- **Season Awareness**: Handles different seasons and timeframes

### **Rich CLI Interface**
- **Beautiful Formatting**: Rich text with colors and formatting
- **Progress Indicators**: Shows processing status
- **Interactive Prompts**: Easy-to-use command interface
- **Error Handling**: Clear error messages and recovery

## üîÆ Future Enhancements

### **Phase 2: Advanced Analytics**
- **Predictive Modeling**: Fantasy point forecasting
- **Trend Analysis**: Season-over-season comparisons
- **Correlation Analysis**: Statistical relationships between metrics
- **Anomaly Detection**: Identifying unusual patterns

### **Phase 3: Real-Time Features**
- **Live Data Integration**: Real-time game data
- **Dynamic Updates**: Live score and stat updates
- **Push Notifications**: Important player updates
- **Live Analysis**: Real-time route running analysis

### **Phase 4: Advanced AI**
- **Vector Database**: Semantic search capabilities
- **Personalization**: User-specific recommendations
- **Voice Interface**: Voice-activated queries
- **Multi-Modal**: Image and video analysis

## üêõ Troubleshooting

### Common Issues

**1. OpenAI API Key Not Set**
```bash
Error: OPENAI_API_KEY environment variable not set
```
**Solution**: Set your API key: `export OPENAI_API_KEY="your-key"`

**2. Database Not Found**
```bash
Error: Database sqlite:///data/fantasy_ppr.db not found
```
**Solution**: Ensure you've run the ETL scripts to generate the databases

**3. Import Errors**
```bash
ModuleNotFoundError: No module named 'openai'
```
**Solution**: Install dependencies: `pip install -r requirements.txt`

### Performance Tips

- **Use Specific Queries**: More specific questions get better responses
- **Enable Verbose Mode**: See the reasoning process for complex queries
- **Choose Right Database**: Use the scoring system that matches your league
- **Batch Questions**: Ask multiple related questions in one session

## üìä Data Sources

The system analyzes data from:
- **Core Stats**: Player game statistics (38,235 records)
- **Advanced Stats**: EPA, CPOE, snap share (38,372 records)
- **Route Data**: Route running metrics (3,558 records)
- **Scheme Data**: Man/Zone coverage analysis (3,558 records)
- **Market Data**: ADP, ECR rankings (4,575 records)

## ü§ù Contributing

To enhance the system:
1. **Add New Agents**: Create specialized agents for new analysis types
2. **Enhance Models**: Improve Pydantic models for better structure
3. **Add Features**: Implement new analysis capabilities
4. **Improve UI**: Enhance the CLI interface

## üìÑ License

This enhanced chat system is part of the Fantasy Football Database project.

---

**üèà Transform your fantasy football analysis with AI-powered insights and structured reasoning!**
